{{ define "title" }}Edit Goal{{ end }}
{{ define "description" }}
  Modify your goal details, update deadlines, mark achievements, and adjust
  visibility settings for your timeline.
{{ end }}
{{ define "main" }}
<div class="flex flex-col gap-2 w-full">
  <a href="/goals" class="text-base-content/50 hover:text-base-content"
    >&larr; Back</a
  >
  <form action="/goals/{{ .Form.ID }}" method="post">
    <fieldset
      class="fieldset bg-base-200 border-base-300 rounded-box border p-4"
    >
      <legend class="fieldset-legend">Goal</legend>

      <label for="goal" class="label">Goal</label>
      <input
        id="goal"
        name="goal"
        value="{{ .Form.Goal }}"
        type="text"
        class="input w-full"
        placeholder="My goal"
      />
      {{ with .Form.Errors.goal }}
        <label class="label">
          <span class="label-text-alt text-error">{{ . }}</span>
        </label>
      {{ end }}


      <label for="due" class="label">Due</label>
      <input
        id="due"
        name="due"
        type="date"
        class="input w-full"
        value="{{ .Form.Due }}"
      />
      {{ with .Form.Errors.due }}
        <label class="label">
          <span class="label-text-alt text-error">{{ . }}</span>
        </label>
      {{ end }}


      <label for="achieved" class="label">
        <input
          id="achieved"
          type="checkbox"
          name="achieved"
          class="checkbox"
          {{ if
            .Form.Achieved
          }}
            checked
          {{ end }}
        />
        Achieved
      </label>
      {{ with .Form.Errors.achieved }}
        <label class="label">
          <span class="label-text-alt text-error">{{ . }}</span>
        </label>
      {{ end }}


      <label for="visible" class="label">
        <input
          id="visible"
          type="checkbox"
          name="visible"
          class="checkbox"
          {{ if
            .Form.VisibleToPublic
          }}
            checked
          {{ end }}
        />
        Visible to the public after shared
      </label>
      {{ with .Form.Errors.visible }}
        <label class="label">
          <span class="label-text-alt text-error">{{ . }}</span>
        </label>
      {{ end }}

      <div class="mt-2">
        <button type="submit" class="btn btn-success btn-sm w-fit">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-check-icon lucide-check"
          >
            <path d="M20 6 9 17l-5-5" />
          </svg>
          Save
        </button>
      </div>
    </fieldset>
  </form>

  <form action="/goals/{{ .Data.GoalID }}/criteria/update" method="post">
    <fieldset
      class="fieldset bg-base-200 border-base-300 rounded-box border p-4 mt-4"
    >
      <legend class="fieldset-legend">Success Criteria</legend>

      {{ if .Data.SuccessCriteria }}
        <ul class="space-y-2 mb-3">
          {{ range .Data.SuccessCriteria }}
            <li class="flex gap-2 items-center bg-white p-3 rounded shadow">
              <input
                type="checkbox"
                name="criteria_{{ .ID }}"
                class="checkbox checkbox-sm"
                {{ if .Completed }}checked{{ end }}
              />
              <span class="flex-1">
                {{ .Description }}
              </span>
              <input type="hidden" name="delete_{{ .ID }}" value="0" />
              <button
                type="button"
                class="btn btn-ghost btn-xs"
                onclick="if(confirm('Delete this item?')) { this.previousElementSibling.value='1'; this.closest('form').submit(); }"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M18 6 6 18M6 6l12 12" />
                </svg>
              </button>
            </li>
          {{ end }}
        </ul>
      {{ end }}

      <div class="flex gap-2 mb-3">
        <input
          type="text"
          name="new_criterion"
          placeholder="Add a success criterion..."
          class="input flex-1"
        />
      </div>

      <div>
        <button type="submit" class="btn btn-success btn-sm">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-check-icon lucide-check"
          >
            <path d="M20 6 9 17l-5-5" />
          </svg>
          Save
        </button>
      </div>
    </fieldset>
  </form>

  <form action="/goals/{{ .Form.ID }}/delete" method="post" onsubmit="return confirm('Are you sure you want to delete this goal? This action cannot be undone.')">
    <fieldset
      class="fieldset bg-base-200 border-error rounded-box border p-4 mt-4"
    >
      <legend class="fieldset-legend text-error">Danger Zone</legend>

      <div class="flex items-start justify-between gap-4">
        <div class="flex-1">
          <p class="font-semibold text-base-content">Delete this goal</p>
          <p class="text-sm text-base-content/70 mt-1">
            Once you delete this goal, there is no going back.
          </p>
        </div>
        <button type="submit" class="btn btn-error btn-sm">
          Delete Goal
        </button>
      </div>
    </fieldset>
  </form>
</div>

  {{ with .Flash }}
    <div hx-ext="remove-me">
      <div
        role="alert"
        remove-me="3s"
        class="absolute bottom-2 md:right-2 right-6 alert alert-success"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6 shrink-0 stroke-current"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <span>{{ .Content }}</span>
      </div>
    </div>
  {{ end }}
{{ end }}
